
class User {
	public i32 id;
	public String firstname;
	public ?String lastname;
	public ?Value<i32> nr;

	public func import_all(Array<Map<?String>> users) Array<User> {
		return Array<User>.make(2);
	}

	public func import(Map<?String> data) !User {

		@ id = data.get("id") or throw missing_field;
		ifnull id throw id_is_null;

		return User {
			id: id.i32() or pass,
		};
	}
}

func _test_query() i32 {

	@ client = main:Client.init("127.0.0.1", "root", "root", "ki", 3306);

	@ db = client.connect() or return {
		println("Failed to connect");
		return 1;
	};

	@ users = db.all("SELECT * FROM users") or return 1;

	println("Results:");

	each users as user {
		@ keys = user.keys();
		each keys as key {
			print(key);
			print(": ");
			@ v = user.get(key) or value "?";
			ifnull v set "null";
			println(v);
		}
	} 

	println("---------------");

	return 0;
}
